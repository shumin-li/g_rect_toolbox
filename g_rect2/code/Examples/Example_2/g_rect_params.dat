%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% The image found in this folder ('Camera01.jpg') as well as the data found below in 
% this parameter file were graciously provided by Tom Shand from Tonkin + Taylor Ltd. 
% Auckland, New Zealand (www.tonkintaylor.co.nz).
% 
% The reference for the image and the data is:
% 
%     Shand, T., Reinen-Hamill, R., Weppe, S. and A. Short (2019) Development of a
%       framework for assessing effects of coastal engineering works on a surf break. 
%       Australasian Coasts and Ports Conference, September 2019, Hobart, Australia.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%% INPUT/OUTPUT INFORMATION
%    imgFname:      This is the only image that will actually be treated
%
%    firstImgFname: This is really just a comment not actually used by the algorithm 
%                   that indicates the name of the first image of a sequence to which 
%                   the georectification of image 'imgFname' could also be applied to.
%
%    lastImgFname:  Same as 'firstImgFname'but for the last sequential image.
%
%    outputFname:   This is the name of the output fil that will contain, among other 
%                   variables, the matrices LON and LAT that will give the ground 
%                   coordinate of every pixel of the image that are below the horizon.
%
imgFname      =  'Camera01.jpg';
firstImgFname =  'Camera01.jpg';
lastImgFname  =  'Camera01.jpg';
outputFname   =  'Camera01_grect.mat';

%% FRAME OF REFERENCE
%    The frame of reference could be either 'Geodetic' or 'Cartesian'.
%    If 'Geodetic' is used, longitudes and latitudes are expected for positions.
%    If 'Cartesian' is used, x-y positions are expected (in m)
%
frameRef = 'Cartesian';

%% CAMERA POSITION 
%    Set the longitude and latitude for ‘Geodetic’ frame of reference 
%    Set the x-y coordinate for ‘Cartesian’ frame of reference.
%
LON0 = 1661768;                 
LAT0 = 5316087;                   

%% OFFSET
%    Offset from center of the principal point (generally zero)
%
ic = 0;
jc = 0;

%% CAMERA PARAMETERS
%    These are either the initial guesses for the uncertain parameters, i.e. those
%    with an uncertainty > 0 (see next section) or the exact values for the parameters
%    with an uncertainty set to 0 below.
%
%    hfov:   Field of view of the camera (degree)
%    lambda: Dip angle (degree) below horizontal (e.g. straight down = 90, horizontal = 0)
%    phi:    Tilt angle (degree), generally close to 0.
%    theta:  View angle (degree) clockwise from North (e.g. straight East = 90)
%    H:      Camera altitude relative to the local water level (m)
%
hfov   = 70;     
lambda = 20;        
phi    =  0;     
theta  = 90;     
H      = 30;    

%% UNCERTAINTIES 
%    Set here the uncertainties of the associated camera parameters. 
%    Set the uncertainty to 0 for fixed parameters.
%
dhfov   = 10;
dlambda = 20;
dphi    =  2;
dtheta  = 10;
dH      =  0;

%% POLYNOMIAL CORRECTION
%    After the geometrical correction, a polynomial correction of degree 1 or 2
%    could be applied. This could correct for some unknown distortions that cannot be
%    corrected on geometrical grounds. Play carefully with this option as it is a purely
%    mathematical fit which may lead to unphysical corrections or may hide other 
%    prior problems with the actual geometrical correction. Always first set this option 
%    to '0' in which case there will be no polynomial correction applied. In principle, 
%    the geometrical fit without this option should already be pretty good. You could then
%    fine tune the image with this option. Be extra careful when using the second order 
%    polynomial fit, especially outside the region of the GCPs as the image could there
%    be completely distorted.
%
polyOrder = 0;

%% PRECISION
%    To save memory, calculations can be done in single precision. 
%    For higher precision set the variable 'precision' to 'double';
%
precision = 'double';

%% GROUND CONTROL POINTS (GCPs). 
%    The GCP data must come right after the 'gcpData = true' instruction 
%    Column 1: horizontal image index of GCPs
%    Column 2: vertical image index of GCPs
%    Column 3: longitude (Geodetic) or x-position (Cartesian) of GCPs
%    Column 4: latitude (Geodetic) or y-position (Cartesian) of GCPs
%    Column 5: elevation (in m) of GCPs (optional)
%
gcpData = true;
1818  490  1661903.38  5316012.52  6.28
1359  662  1661846.11  5316069.20  6.11
 543 1080  1661802.48  5316102.36  6.27
1584  479  1661926.61  5316026.49  3.90
1226  535  1661902.92  5316070.64  2.45
 617  836  1661828.83  5316109.15  2.47
1475  347  1662214.16  5315956.24  1.58
 974  355  1662195.27  5316115.86  1.10
  14  583  1661893.51  5316195.60  0.43
 595  382  1662132.48  5316216.56  0.60
 132  408  1662085.97  5316320.83  0.42